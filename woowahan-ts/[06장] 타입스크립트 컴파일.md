## 자바스크립트 런타임 / 타입스크립트 컴파일

- 컴파일 : 소스코드 → 기계어 코드
- 런타임 : 프로그램이 메모리에 적재 & 실행

메모리 어디에 저장될까?

<aside>
💡

이때 메모리란, JS 엔진에서 저장할 수 있는 영역으로 `Heap` 과 `Stack` 이 존재

`Heap` 에는 동적 메모리 할당, 객체와 함수를 저장하는 데이터를 저장

이때, 고정된 크기의 메모리를 할당하지 않음

`Stack` 에는 정적 메모리 할당, 원시값이나 객체 및 함수를 가리키는 참조가 여기에 저장

</aside>

---

### 자바스크립트 런타임

- 자바스크립트 실행 환경 : 인터넷 브라우저(크롬, 사파리)나 Node.js
- 런타임 구성요소 : 자바스크립트엔진 / 웹 API / 콜백큐 / 이벤트루프 / 랜더큐

<aside>
💡

- JavaScript Engine
  - **V8**(Chrome, Node.js), **SpiderMonkey**(Firefox) → JS 코드 파싱/실행
- 웹 API
  - 비동기 대신 처리해줌 (JS 엔진이 아니라, 브라우저가 처리)
  - `setTimeout`, `fetch`, `DOM`, `console.log`, `addEventListener`
- 콜백큐
  - 비동기처리 돌린 후, 콜스택 들어가기 전에 **콜백함수들이 대기하는 공간**
- 이벤트루프
  - 콜스택이 비어있는지 감시해주는 역할, 비었다면 대기하고 있는 콜백함수를 콜백큐 ⇒ 콜스택 이동시킴
- 랜더큐 - 애니메이션과 화면 업데이트 작업을 처리하는 데 사용 (`requestAnimationFrame`)
</aside>

---

### 타입스크립트 컴파일

- 일반적인 컴파일은, 고수준언어를 → 저수준 언어로 변환하는 과정
- 따라서, 고수준 언어(ts)를 → 고수준 언어(js)로 변환하는 과정을 **트랜스파일이라고 하기도 함**

**타입스크립트 컴파일과 자바스크립트의 런타임 과정**

(1) 타입스크립트 AST 생성 ⇒ (2) AST로 타입검사 ⇒ (3) 타입스크립트 AST 자바스크립트로 변환 ⇒

(4) 자바스크립트 AST 생성 ⇒ (5) AST 바이트 코드로 변환 ⇒ (6) 프로그램 실행

- 타입스크립트 코드는 타입만을 확인한데만 사용하고, 런타임에는 영향을 주지 않음

<aside>
💡

런타임 + 타입 : `const … as const` / `typeof` + `keyof`

타입만 필요 : `유니온 타입`

런타임 (양방향 참조 쓸때) : `enum`

</aside>

- 컴파일 후 JS로 변환된 enum

  ```tsx
  enum Status {
    LOADING = 'loading',
    SUCCESS = 'success',
  }

  // 컴파일 후 JS
  var Status;
  (function (Status) {
    Status['LOADING'] = 'loading';
    Status['SUCCESS'] = 'success';
  })(Status || (Status = {}));
  ```

- 아무튼 타입스크립트 덕분에, 컴파일 에러를 발견하여 프로그램 실행을 막는다 (`정적 타입 검사기`)

---

## 타입스크립트 컴파일러 동작

### 타입 검사기 (코드 검사기)

- 타입스크립트 컴파일러에서 런타임 에러 문법 catch & 타입 에러 catch
- `ts binder`를 사용하여 타입검사 (symbol 생성 후, 스코프 설정 & 타입검사에 사용할 기초 테이블 구성)

### 코드 변환기

- 타입스크립트 코드를 자바스크립트로 트랜스파일 (설정한 버전에 따라 다름)
- 타입검사와 자바스크립트로의 코드 변환은 독립적인 동작
  - 타입 에러가 나도, 자바스크립트 코드로 변환 (단, 설정에 따라 다를 수 있음)

`바벨`도 트랜스파일해주는 역할이고, `tsc`도 트랜스파일해준다면, 둘의 차이는?

- 타입검사의 유무 (바벨은 단순 es5 이하로 자바스크립트 코드 컴파일)

---

## 타입스크립트 컴파일러의 구조

**전체적인 컴파일 관리 프로그램 객체 생성 ⇒ 스캐너 ⇒ 파서 ⇒ 바인더 ⇒ 체커 ⇒ 이미터**

|                            |                                                                                           |
| -------------------------- | ----------------------------------------------------------------------------------------- |
| **1. 스캐너 (Scanner)**    | 소스코드를 문자 단위로 읽어들여 토큰으로 분리 / 키워드, 식별자, 숫자, 기호 등으로 쪼갬    |
| **2. 파서 (Parser)**       | 토큰을 기반으로 **AST**생성 / 구문적 분석 수행 (계층 구조 생성)                           |
| **3. 바인더 (Binder)**     | AST를 순회하며 심벌 생성하고 스코프(Scope)에 바인딩 / 변수, 함수 등의 이름을 의미와 연결  |
| **4. 체커 (Type Checker)** | 바인더가 만든 심벌을 기반으로 타입 검사 수행 **/** 타입 오류 탐지, 타입 추론, 유효성 검사 |
| **5. 이미터 (Emitter)**    | 최종적으로 AST를 **자바스크립트 코드로 변환 /** `.js` 파일 생성 (런타임용)                |
